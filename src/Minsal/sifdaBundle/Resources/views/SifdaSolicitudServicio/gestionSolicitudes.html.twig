{% extends 'MinsalsifdaBundle::layoutResponsable.html.twig' %}

{% block contenido_in -%}
    <div class="page-header">
        Fecha del sistema: {{ "now"|date("d/m/Y") }} usuario:{{usuario.username}} dependencia:{{usuario.idDependenciaEstablecimiento.idDependencia}}
        <center><h3>Gestion de solicitudes de servicio</h3></center>
    
    </div>
    <div id="seleccion">
        <div class="row-fluid">
            <div class="span11 offset1">
                <div class="span4">
                 <table>
                            <tr>
                                <td>
                                <input type="radio" name="consulta" id="Todos" value="Todos">Todos</td>
                                
                                </td>
                            </tr>
                            <tr>
                                <td><input type="radio" name="consulta" id="especifico" value="especifico" >Especifico</td>
                            </tr>
                                
                 </table>
                </div>
                
                            
                <div class="span3">
                    
                
                  <table id="combos">
                    <tr>
                          <div class="btn-group">
                                    <select id="cmb1" name="ComboEstado"  class="selectpicker" style="width: 200px">
                                     <option value="0">Tipo Servicio</option>
                                     
                                     {% for t in tiposervicio %}
                               
                                        <option value="{{t.id}}">{{t.nombre}}</option>
                                     {% endfor %}   
                                    </select>
                               </div>
                            
                          
                           
                      </tr>
                      
                  </table>        
                    
                                   
                </div>
                <div class="span4">
                    <table id="fechas">
                                    <tr>
                                        <td><label>FechaInicio: </label></td>
                                        <td>
                                            <input type="text" id="fechaInicio" class="input-small" >
                                        </td>  
                                    </tr>
                                    <tr>
                                        <td><label>FechaFin: </label></td>
                                        <td>
                                            <input type="text" id="fechaFin" class="input-small" >
                                        </td>
                                        <td></td><td></td>
                                        <td>
                                            <input type="submit" class="btn btn-primary" id="buscar" value="Buscar" name="Buscar">
                                        </td>
                                    </tr>
                                    
                    </table>            
                    
                </div>                   
                <div id="seleccion">

                </div>
        </div>    
    </div>
  </div> 
  <div class="row-fluid">
            <div class="span12">
            
                {% if entities%}
                <div id="rangoTabla"></div>
                {% endif %}
                {% if asignados%}
                <div id="rangoAsigTabla"></div>
                {% endif %}
                {% if rechazados%}
                <div id="rangoRechTabla"></div>
                {% endif %}
               
     <br/>           
    {% if entities%}
    <table id="tabla" class="table table-bordered table-hover table-condensed">
        <thead>
            <tr>
                <th><center>N°</center></th>
                <th><center>Dependencia solicitante</center></th>
                <th><center>Tipo de servicio</center></th>
                <th><center>Persona solicitante</center></th>
                <th><center>Descripci&oacute;n</center></th>
                {#<th><center>Fecha de recepcion</center></th>#}
                <th><center>Fecha que requiere</center></th>
                <th><center>Acciones</center></th>
            </tr>
        </thead>
        <tbody>
         {%set count=1%}   
            
        {% for entity in entities %}
            
            {%if entity.idDependenciaEstablecimiento == usuario.idDependenciaEstablecimiento%}
                
            <tr>
                {#<td><a href="{{ path('sifda_solicitudservicio_show', { 'id': entity.id }) }}">{{ entity.id }}</a></td>#} 
                <td>{{ count }}</td>
                {#<td>{{ loop.index }}</td>#}
                <td><justify>{{ entity.user.idDependenciaEstablecimiento.idDependencia }}, {{ entity.user.idDependenciaEstablecimiento.idEstablecimiento }}</justify></td>
                <td>{{ entity.idTipoServicio }}</td>
                <td>{{entity.user.idEmpleado}}</td>
                <td>{{ entity.descripcion }}</td>
                {#<td>{% if entity.fechaRecepcion %}{{ entity.fechaRecepcion|date('d-m-Y') }}{% endif %}</td>#}
                <td>{% if entity.fechaRequiere %}{{ entity.fechaRequiere|date('d/m/Y') }}{% endif %}</td>
                
                <td>
                <ul>
                    <li>                        
                        <a  href="{{ path('sifda_ordentrabajo_new', { 'id': entity.id }) }}">Crear orden de trabajo</a>
                    </li>
                    <li>                        
                        {#<a  href="javascript:ShowDialog({{ loop.index }});">Rechazar solicitud de servicio</a>
                        <input type="hidden" id="txt{{ loop.index }}"  value="{{entity.id}}">#}
                        <a  href="{{ path('sifda_solicitudservicio_rechazo', { 'id': entity.id }) }} ">Rechazar solicitud de servicio</a>
                        
                    </li>
                    

                    <li>                        
                        <a  href="{{ path('sifda_reprogramacion_servicio_new', { 'id': entity.id }) }} ">Reprogramar solicitud de servicio</a>
                    </li>
                    
                  </ul>
                </td>
            </tr>
            {%set count=count+1%}
            {%endif%} 
            
        {% endfor %}
        </tbody>
    </table>
    {% else %}
        <div id="msgIngresados">
            <center><h4>No se encontraron solicitudes Ingresadas</h4></center>
        </div>
        
    {% endif %}  
                
            </div>
               
             <div id="msgIngresados2">
              <center><h4>No se encontraron solicitudes en este Rango</h4></center>
             </div>   
        </div>              
        <div id="dialog">

        </div>
        <br>
  
        <div id="dialogConfirm">
            <span id="spanMessage"></span>
        </div>
         
        
    {% endblock %}

{% block javascripts_step %}
    {{ parent() }}
    <script>
    $(document).ready(function(){

        {#Condiciones Iniciales de la Pantalla#}
        
      {#document.getElementById('cmb1').value=1; #}
      
      document.getElementById("cmb1").value="0";
      document.getElementById('Todos').checked=true;
      
      document.getElementById('fechaInicio').value="";
      document.getElementById('fechaFin').value="";
     
      document.getElementById('fechaInicio').readOnly=true;
      document.getElementById('fechaFin').readOnly=true;
      $('#fechas').hide("slow");
      $('#cmb1').hide("slow");
      $('#msgIngresados2').hide("slow");
      
      
      
           
     {#document.getElementById("minsal_sifdabundle_sifdasolicitudservicio_establecimiento").value="";#}
                
        {#$("#cmb1").change(function(){ 

            var IdEstablecimiento = $("#cmb1").val();

             
            if(IdEstablecimiento !="")
            {
                $.post(
                '{{path('sifda_solicitudservicio_find_dependencia')}}', 
                  { 
                    idEstablecimiento:IdEstablecimiento
                  }
                  , function( data ) {
                    console.log( data );
                        $("#cmb2").html(data);

                 }, "json");
            }
            else 
            {
                $.post(
                '{{path('sifda_solicitudservicio_select_dependencia')}}', 
                    function( data ) {
                    console.log( data );
                        $("#cmb2").html(data);

                 }, "json");
                 
                $.post(
                 '{{path('sifda_solicitudservicio_select_tipo_servicio')}}', 
                    function( data ) {
                    console.log( data );
                        $("#cmb3").html(data);

                 }, "json");  
            }
        });#}
        
        {#$("#cmb2").change(function(){
            var IdDependencia = $("#cmb2").val();
           
            if(IdDependencia !="")
            {
                $.post(
                    '{{path('sifda_solicitudservicio_find_tipo_servicio')}}', 
                      { 
                        IdDependencia:IdDependencia
                      }
                      , function( data ) {
                        console.log( data );
                            $("#cmb3").html(data);

                     }, "json");
             }
             else
             {
                $.post(
                    '{{path('sifda_solicitudservicio_select_tipo_servicio')}}', 
                        function( data ) {
                        console.log( data );
                            $("#cmb3").html(data);

                     }, "json");                
                 
             }
        });#}
      
     {#  $('#AsigTabla').hide("slow");
       $('#RechTabla').hide("slow"); 
    
       $('#msgIngresados').hide("slow"); 
       $('#msgAsignados').hide("slow");
       $('#msgRechazados').hide("slow");   #}
        
       {#Fin de Condiciones Iniciales#} 
       
       {#Comportamiento Radio Buttons#}
    
        $('#Todos').click(function(){
            
           {# $("#btn1").show("slow");#}
            $("#fechas").hide("slow");
            $("#cmb1").hide("slow");
            $('#tabla').show("slow");
            $('#rangoTabla').hide("slow");
            $('#msgIngresados2').hide("slow");
          });
          
            $('#especifico').click(function(){

                {#$("#btn1").hide("slow");#}
                $("#tabla").hide("slow");
                $("#fechas").show("slow");
                $("#cmb1").show("slow");
                $('#rangoTabla').show("slow");
                $('#msgIngresados2').hide("slow");
                {#$('#msgRechazados').hide("slow");
                $('#msgAsignados').hide("slow");#}
              });   
          
          $("#buscar").click(function (){
              
                  
              var fechaInicio=$("#fechaInicio").val();
              var fechaFin=$("#fechaFin").val();
              var tipoServicio=$("#cmb1").val();
              
             alert(tipoServicio);
              
            if(fechaFin !="" && fechaInicio!="" && tipoServicio!="0"){
                  
                  $.post(
                    '{{path('sifda_solicitudservicio_buscar_solicitudes_ingresadas')}}',    
                    
                    { 
                      fechaInicio: fechaInicio,
                      fechaFin   : fechaFin,
                      tipoServicio: tipoServicio
                    }
                        , function( data ) {
                           console.log( data );
                           
                           res=data.val;
                           
                           if(res=="0"){
                               
                               $('#msgIngresados2').show("slow");
                               $("#rangoTabla").hide("slow");
                            }            
                            else
                           {
                              $("#rangoTabla").html(data);
                           }
                           
                                         
                    }, "json");
            
                    
              }
          });
          
          {#Comportamiento Boton Buscar1#}
          
       {#   $('#bbuscar').click(function(){
              
              var Combo = $("#cmb1").val();
              var ck = $("#Todos").val();
              
              if(Combo==='1' && ck==='Todos'){
                   $('#fechas').hide("slow");
                   $('#tabla').show("slow");
                   $('#rangoTabla').hide("slow");
                   $('#msgIngresados').show("slow");
                   $('#AsigTabla').hide("slow");
                   $('#rangoAsigTabla').hide("slow");
                   $('#msgAsignados').hide("slow");
                   $('#RechTabla').hide("slow");
                   $('#rangoRechTabla').hide("slow");
                   $('#msgRechazados').hide("slow");
              }
              
              if(Combo==='2' && ck==='Todos'){
                   $('#fechas').hide("slow");
                   $('#tabla').hide("slow");
                   $('#rangoTabla').hide("slow");
                   $('#msgIngresados').hide("slow");
                   $('#AsigTabla').show("slow");
                   $('#rangoAsigTabla').hide("slow");
                   $('#msgAsignados').show("slow");
                   $('#RechTabla').hide("slow");
                   $('#rangoRechTabla').hide("slow");
                   $('#msgRechazados').hide("slow");
              }
              
              if(Combo==='3' && ck==='Todos'){
                   $('#fechas').hide("slow");
                   $('#tabla').hide("slow");
                   $('#rangoTabla').hide("slow");
                   $('#msgIngresados').hide("slow");
                   $('#AsigTabla').hide("slow");
                   $('#rangoAsigTabla').hide("slow");
                   $('#msgAsignados').hide("slow");
                   $('#RechTabla').show("slow");
                   $('#rangoRechTabla').hide("slow");
                   $('#msgRechazados').show("slow");
                  
              }
          });  
#}
        {#Comportamiento Boton Buscar2#}
            
        {# $('#bbuscar2').click(function(){
             
             var Combo = $("#cmb1").val();
             var ck = $("#especifico").val();
             
              if(Combo==='1' && ck==='especifico'){
                  
                   $('#tabla').hide("slow");
                   $('#AsigTabla').hide("slow");
                   $('#RechTabla').hide("slow");
                   $('#rangoTabla').show("slow");
                   $('#rangoAsigTabla').hide("slow");
                   $('#rangoRechTabla').hide("slow");
                   $('#msgAsignados').hide("slow");
                   $('#msgRechazados').hide("slow");
                   
                   $.post(
                    '{{path('sifda_solicitudservicio_buscar_solicitudes_ingresadas')}}',    #} 
                    
                    {#{ 
                      fechaInicio:$("#fechaInicio").val(),
                      fechaFin   :$("#fechaFin").val()
                    }
                        , function( data ) {
                           console.log( data );
                         $("#rangoTabla").html(data);
                
                    }, "json");
            
                    $('#msgIngresados').show("slow");
              }
              
              if(Combo==='2' && ck==='especifico'){
                  
                  $('#tabla').hide("slow");
                  $('#AsigTabla').hide("slow");
                  $('#RechTabla').hide("slow");
                  $('#rangoTabla').hide("slow");
                  $('#rangoAsigTabla').show("slow");
                  $('#rangoRechTabla').hide("slow");
                  $('#msgIngresados').hide("slow");
                  $('#msgRechazados').hide("slow");
                  
                   $.post(
                    '{{path('sifda_solicitudservicio_buscar3_solicitudes')}}',
                    { 
                      fechaInicio:$("#fechaInicio").val(),
                      fechaFin   :$("#fechaFin").val()
                    }
                        , function( data ) {
                           console.log( data );
                         $("#rangoAsigTabla").html(data);
                
                    }, "json");
            
                    $('#msgAsignados').show("slow");
                  
              }
              
              if(Combo==='3' && ck==='especifico'){
               
                  $('#tabla').hide("slow");
                  $('#AsigTabla').hide("slow");
                  $('#RechTabla').hide("slow");
                  $('#rangoTabla').hide("slow");
                  $('#rangoAsigTabla').hide("slow");
                  $('#rangoRechTabla').show("slow");
                  $('#msgIngresados').hide("slow");
                  $('#msgAsignados').hide("slow");
                  
                  
                   $.post(
                    '{{path('sifda_solicitudservicio_buscar2_solicitudes')}}',
                    { 
                      fechaInicio:$("#fechaInicio").val(),
                      fechaFin   :$("#fechaFin").val()
                    }
                        , function( data ) {
                           console.log( data );
                         $("#rangoRechTabla").html(data);
                
                    }, "json");
            
                    $('#msgRechazados').show("slow");
              }
        }); #}  
          
}); {#Fin Jquery#}       
          
    
    
    $.datepicker.regional['es'] = {
			 closeText: 'Cerrar',
			 prevText: '<Ant',
			 nextText: 'Sig>',
			 currentText: 'Hoy',
			 monthNames: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
			 monthNamesShort: ['Ene','Feb','Mar','Abr', 'May','Jun','Jul','Ago','Sep', 'Oct','Nov','Dic'],
			 dayNames: ['Domingo', 'Lunes', 'Martes', 'Mi�rcoles', 'Jueves', 'Viernes', 'S�bado'],
			 dayNamesShort: ['Dom','Lun','Mar','Mi�','Juv','Vie','S�b'],
			 dayNamesMin: ['Do','Lu','Ma','Mi','Ju','Vi','S�'],
			 weekHeader: 'Sm',
			 showButtonPanel:false,
			 showAnim:'show',
                         changeMonth: true,
			 changeYear: true,
                         {#minDate: new Date(2014, 1, 1), 
                         maxDate: "1D",#}
                         dateFormat: 'yy-mm-dd',
			 firstDay: 1,
			 isRTL: false,
			 showMonthAfterYear: false,
			 			                         
                         onClose: function (selectedDate) {
                         
                          $("#fechaInicio").datepicker("option", "maxDate", selectedDate);
                          $("#fechaFin").datepicker("option", "minDate", selectedDate);
                          
                         },
                         
                         yearSuffix: ''
                         
			 };
			$.datepicker.setDefaults($.datepicker.regional['es']);
			$(function() {
				$( "#fechaInicio" ).datepicker(
					
					);
                                
                                $( "#fechaFin" ).datepicker(
					
					);
                                
                                
				}); 
                                       
       
    function confirmar(valor){ 
        
        {#var id= $("#txt"+valor).val();#}
        
        {#alert('id enviado: '+id);#}
        confirmar=confirm("Desea Rechazar la Solicitud?"); 
        if (confirmar)
            LlamarControlador('{{path('sifda_solicitudservicio_rechazar')}}',$("#txt"+valor).val());
        // si pulsamos en aceptar
            {#{
                $.post(
                '{{path('sifda_solicitudservicio_rechazar')}}',         
                 { 
                    id:$("#txt"+valor).val(),
                    
                 }
                 , function( data ) {
                console.log( data );
                    $("#rangoTabla").html(data);
                
             }, "json");      
             
             alert("Solicitud Rechazada Exitosamente ");
            }#}
           {# alert('{{path(sifda_solicitudservicio_rechazar),'id':}}');   
           '{{ path('sifda_solicitudservicio_rechazar', { 'id': valor }) }}';#}
         
        
        else 
        // si pulsamos en cancelar
        alert('Has dicho que no'); 
    
    
}  
    
    function LlamarControlador(url,valor)
    {
        $.post(
            url,
            {
                id:valor
            }).done(function(){
                {#alert("Solicitud Rechazada Exitosamente");#}
                 window.location='{{path('sifda_gestionSolicitudes')}}';   
                ('#dialog').attr('title','Confirmacion').text('Solicitud Rechazada Correctamente').dialog();               
                
            });
    }
    
    function aceptarSolicitud(url,valor2)
    {
        {#alert(valor2);
        alert($("#txt_"+valor2).val());#}
       
        $.post(
            url,
            {
                id:valor2    
            }).done(function(){
                 window.location='{{path('sifda_gestionSolicitudes')}}';   
                ('#dialog').attr('title','Confirmacion').text('La solicitud ha sido aceptada correctamente').dialog();               
                
            });
    }    
    
    /*Codigo para nueva ventana*/
  function ShowDialog(valor) {
  
   {# alert(valor);
    alert($("#txt"+valor).val());#}
    
        $('#spanMessage').html('¿Está seguro(a) de Rechazar la Solicitud?');
        $("#dialogConfirm").dialog({
            resizable: false,
            height: 160,
            width: 300,
            modal: true,
            title: 'Confirmacion',
            buttons: {
                'Aceptar': function () {
                    {#alert('{{path('sifda_solicitudservicio_rechazar')}}');#}
                    {#alert($("#txt"+valor).val());#}
                    LlamarControlador('{{path('sifda_solicitudservicio_rechazar')}}',$("#txt"+valor).val());
                    {#$("<div><span>Solicitud Rechazada correctamente</span></div>").appendTo(document.body);#}
                    $(this).dialog("close");
                },
                    'Cancelar': function () {
                    $(this).dialog("close");
                }
            }
        });
    }
    
    /*Codigo para aceptar la solicitud que ha sido rechazada*/
    function ShowDialog2(valor2) {
    
    {#alert(valor2);
    alert($("#txt_"+valor2).val());#}
    
        $('#spanMessage').html('¿Está seguro(a) de aceptar la solicitud?');
        $("#dialogConfirm").dialog({
            resizable: false,
            height: 160,
            width: 300,
            modal: true,
            title: 'Confirmacion',
            buttons: {
                'Aceptar': function () {
                    aceptarSolicitud('{{path('sifda_solicitudservicio_aceptar')}}',$("#txt_"+valor2).val());
                    $(this).dialog("close");
                },
                    'Cancelar': function () {
                    $(this).dialog("close");
                }
            }
        });
    }
    /*Fin del codigo de ventana*/
   
   function mostrarfi(){ 
      return $("#fechaInicio").val();
        
    }
    
      function mostrarff(){ 
       return $("#fechaFin").val();
        
    }
   
   function LimpiarCamposFecha(){
            
        document.getElementById('fechaInicio').value="";
        document.getElementById('fechaFin').value="";
        
    }
    
    </script>
    {% endblock%}
    
   